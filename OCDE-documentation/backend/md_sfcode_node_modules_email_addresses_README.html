<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sfcode: email-addresses.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sfcode
   </div>
   <div id="projectbrief">An Online Competing and Development Environment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">email-addresses.js </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An RFC 5322 email address parser.</p>
<p>v 3.1.0</p>
<h1><a class="anchor" id="autotoc_md8357"></a>
What?</h1>
<p>Want to see if something could be an email address? Want to grab the display name or just the address out of a string? Put your regexes down and use this parser!</p>
<p>This library does not validate email addresses - we can't really do that without sending an email. However, it attempts to parse addresses using the (fairly liberal) grammar specified in RFC 5322. You can use this to check if user input looks like an email address.</p>
<p>Note carefully though - this parser supports all features of RFC 5322, which means that <code>"Bob Example" &lt;bob@example.com&gt;</code> is a valid email address. If you just want to validate the <code>bob@example.com</code> part, that is RFC 5321, for which you want to use something like node-address-rfc2821.</p>
<h1><a class="anchor" id="autotoc_md8358"></a>
Why use this?</h1>
<p>Use this library because you can be sure it really respects the RFC:</p><ul>
<li>The functions in the recursive decent parser match up with the productions in the RFC</li>
<li>The productions from the RFC are written above each function for easy verification</li>
<li>Tests include all of the test cases from the <a href="https://github.com/dominicsayers/isemail">is_email</a> project, which are extensive</li>
</ul>
<h1><a class="anchor" id="autotoc_md8359"></a>
Installation</h1>
<p>npm install email-addresses</p>
<h1><a class="anchor" id="autotoc_md8360"></a>
Example</h1>
<div class="fragment"><div class="line">$ node</div>
<div class="line">&gt; addrs = require(&quot;email-addresses&quot;)</div>
<div class="line">{ [Function: parse5322]</div>
<div class="line">  parseOneAddress: [Function: parseOneAddressSimple],</div>
<div class="line">  parseAddressList: [Function: parseAddressListSimple] }</div>
<div class="line">&gt; addrs.parseOneAddress(&#39;&quot;Jack Bowman&quot; &lt;jack@fogcreek.com&gt;&#39;)</div>
<div class="line">{ parts:</div>
<div class="line">   { name: [Object],</div>
<div class="line">     address: [Object],</div>
<div class="line">     local: [Object],</div>
<div class="line">     domain: [Object] },</div>
<div class="line">  name: &#39;Jack Bowman&#39;,</div>
<div class="line">  address: &#39;jack@fogcreek.com&#39;,</div>
<div class="line">  local: &#39;jack&#39;,</div>
<div class="line">  domain: &#39;fogcreek.com&#39; }</div>
<div class="line">&gt; addrs.parseAddressList(&#39;jack@fogcreek.com, Bob &lt;bob@example.com&gt;&#39;)</div>
<div class="line">[ { parts:</div>
<div class="line">     { name: null,</div>
<div class="line">       address: [Object],</div>
<div class="line">       local: [Object],</div>
<div class="line">       domain: [Object] },</div>
<div class="line">    name: null,</div>
<div class="line">    address: &#39;jack@fogcreek.com&#39;,</div>
<div class="line">    local: &#39;jack&#39;,</div>
<div class="line">    domain: &#39;fogcreek.com&#39; },</div>
<div class="line">  { parts:</div>
<div class="line">     { name: [Object],</div>
<div class="line">       address: [Object],</div>
<div class="line">       local: [Object],</div>
<div class="line">       domain: [Object] },</div>
<div class="line">    name: &#39;Bob&#39;,</div>
<div class="line">    address: &#39;bob@example.com&#39;,</div>
<div class="line">    local: &#39;bob&#39;,</div>
<div class="line">    domain: &#39;example.com&#39; } ]</div>
<div class="line">&gt; addrs(&quot;jack@fogcreek.com&quot;)</div>
<div class="line">{ ast:</div>
<div class="line">   { name: &#39;address-list&#39;,</div>
<div class="line">     tokens: &#39;jack@fogcreek.com&#39;,</div>
<div class="line">     semantic: &#39;jack@fogcreek.com&#39;,</div>
<div class="line">     children: [ [Object] ] },</div>
<div class="line">  addresses:</div>
<div class="line">   [ { node: [Object],</div>
<div class="line">       parts: [Object],</div>
<div class="line">       name: null,</div>
<div class="line">       address: &#39;jack@fogcreek.com&#39;,</div>
<div class="line">       local: &#39;jack&#39;,</div>
<div class="line">       domain: &#39;fogcreek.com&#39; } ] }</div>
<div class="line">&gt; addrs(&quot;bogus&quot;)</div>
<div class="line">null </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8361"></a>
API</h1>
<h1><a class="anchor" id="autotoc_md8362"></a>
&lt;tt&gt;obj = addrs(opts)&lt;/tt&gt;</h1>
<p>Call the module directly as a function to get access to the AST. Returns null for a failed parse (an invalid address).</p>
<p>Options:</p>
<ul>
<li><code>string</code> - An email address to parse. Parses as <code>address-list</code>, a list of email addresses separated by commas.</li>
<li><code>object</code> with the following keys:<ul>
<li><code>input</code> - An email address to parse. Required.</li>
<li><code>rfc6532</code> - Enable rfc6532 support (unicode in email addresses). Default: <code>false</code>.</li>
<li><code>partial</code> - Allow a failed parse to return the AST it managed to produce so far. Default: <code>false</code>.</li>
<li><code>simple</code> - Return just the address or addresses parsed. Default: <code>false</code>.</li>
<li><code>strict</code> - Turn off features of RFC 5322 marked "Obsolete". Default: <code>false</code>.</li>
<li><code>rejectTLD</code> - Require at least one <code>.</code> in domain names. Default: <code>false</code>.</li>
<li><code>startAt</code> - Start the parser at one of <code>address-list</code>, <code>from</code>, <code>sender</code>, <code>reply-to</code>. Default: <code>address-list</code>.</li>
</ul>
</li>
</ul>
<p>Returns an object with the following properties:</p>
<ul>
<li><code>ast</code> - the full AST of the parse.</li>
<li><code>addresses</code> - array of addresses found. Each has the following properties:<ul>
<li><code>parts</code> - components of the AST that make up the address.</li>
<li><code>type</code> - The type of the node, e.g. <code>mailbox</code>, <code>address</code>, <code>group</code>.</li>
<li><code>name</code> - The extracted name from the email. e.g. parsing <code>"Bob" &lt;bob@example.com&gt;</code> will give <code>Bob</code> for the <code>name</code>.</li>
<li><code>address</code> - The full email address. e.g. parsing the above will give <code>bob@example.com</code> for the <code>address</code>.</li>
<li><code>local</code> - The local part. e.g. parsing the above will give <code>bob</code> for <code>local</code>.</li>
<li><code>domain</code> - The domain part. e.g. parsing the above will give <code>example.com</code> for <code>domain</code>.</li>
</ul>
</li>
</ul>
<p>Note if <code>simple</code> is set, the return will be an array of addresses rather than the object above.</p>
<p>Note that addresses can contain a <code>group</code> address, which in contrast to the <code>address</code> objects will simply contain two properties: a <code>name</code> and <code>addresses</code> which is an array of the addresses in the group. You can identify groups because they will have a <code>type</code> of <code>group</code>. A group looks something like this: <code>Managing Partners:ben@example.com,carol@example.com;</code></p>
<h1><a class="anchor" id="autotoc_md8363"></a>
&lt;tt&gt;obj = addrs.parseOneAddress(opts)&lt;/tt&gt;</h1>
<p>Parse a single email address.</p>
<p>Operates similarly to <code>addrs(opts)</code>, with the exception that <code>rfc6532</code> and <code>simple</code> default to <code>true</code>.</p>
<p>Returns a single address object as described above. If you set <code>simple: false</code> the returned object includes a <code>node</code> object that contains the AST for the address.</p>
<h1><a class="anchor" id="autotoc_md8364"></a>
&lt;tt&gt;obj = addrs.parseAddressList(opts)&lt;/tt&gt;</h1>
<p>Parse a list of email addresses separated by comma.</p>
<p>Operates similarly to <code>addrs(opts)</code>, with the exception that <code>rfc6532</code> and <code>simple</code> default to <code>true</code>.</p>
<p>Returns a list of address objects as described above. If you set <code>simple: false</code> each address will include a <code>node</code> object that containst the AST for the address.</p>
<h1><a class="anchor" id="autotoc_md8365"></a>
&lt;tt&gt;obj = addrs.parseFrom(opts)&lt;/tt&gt;</h1>
<p>Parse an email header "From:" address (specified as mailbox-list or address-list).</p>
<p>Operates similarly to <code>addrs(opts)</code>, with the exception that <code>rfc6532</code> and <code>simple</code> default to <code>true</code>.</p>
<p>Returns a list of address objects as described above. If you set <code>simple: false</code> each address will include a <code>node</code> object that containst the AST for the address.</p>
<h1><a class="anchor" id="autotoc_md8366"></a>
&lt;tt&gt;obj = addrs.parseSender(opts)&lt;/tt&gt;</h1>
<p>Parse an email header "Sender:" address (specified as mailbox or address).</p>
<p>Operates similarly to <code>addrs(opts)</code>, with the exception that <code>rfc6532</code> and <code>simple</code> default to <code>true</code>.</p>
<p>Returns a single address object as described above. If you set <code>simple: false</code> the returned object includes a <code>node</code> object that contains the AST for the address.</p>
<h1><a class="anchor" id="autotoc_md8367"></a>
&lt;tt&gt;obj = addrs.parseReplyTo(opts)&lt;/tt&gt;</h1>
<p>Parse an email header "Reply-To:" address (specified as address-list).</p>
<p>Operates identically to <code>addrs.parseAddressList(opts)</code>.</p>
<h2><a class="anchor" id="autotoc_md8368"></a>
Usage</h2>
<p>If you want to simply check whether an address or address list parses, you'll want to call the following functions and check whether the results are null or not: <code>parseOneAddress</code> for a single address and <code>parseAddressList</code> for multiple addresses.</p>
<p>If you want to examine the parsed address, for example to extract a name or address, you have some options. The object returned by <code>parseOneAddress</code> has four helper values on it: <code>name</code>, <code>address</code>, <code>local</code>, and <code>domain</code>. See the example above to understand is actually returned. (These are equivalent to <code>parts.name.semantic</code>, <code>parts.address.semantic</code>, etc.) These values try to be smart about collapsing whitespace, quotations, and excluding RFC 5322 comments. If you desire, you can also obtain the raw parsed tokens or semantic tokens for those fields. The <code>parts</code> value is an object referencing nodes in the AST generated. Nodes in the AST have two values of interest here, <code>tokens</code> and <code>semantic</code>.</p>
<div class="fragment"><div class="line">&gt; a = addrs.parseOneAddress(&#39;Jack  Bowman  &lt;jack@fogcreek.com &gt;&#39;)</div>
<div class="line">&gt; a.parts.name.tokens</div>
<div class="line">&#39;Jack  Bowman  &#39;</div>
<div class="line">&gt; a.name</div>
<div class="line">&#39;Jack Bowman&#39;</div>
<div class="line">&gt; a.parts.name.semantic</div>
<div class="line">&#39;Jack Bowman &#39;</div>
<div class="line">&gt; a.parts.address.tokens</div>
<div class="line">&#39;jack@fogcreek.com &#39;</div>
<div class="line">&gt; a.address</div>
<div class="line">&#39;jack@fogcreek.com&#39;</div>
<div class="line">&gt; a.parts.address.semantic</div>
<div class="line">&#39;jack@fogcreek.com&#39; </div>
</div><!-- fragment --><p>If you need to, you can inspect the AST directly. The entire AST is returned when calling the module's function.</p>
<h2><a class="anchor" id="autotoc_md8369"></a>
References</h2>
<ul>
<li><a href="http://tools.ietf.org/html/rfc5322">http://tools.ietf.org/html/rfc5322</a></li>
<li><a href="https://tools.ietf.org/html/rfc6532">https://tools.ietf.org/html/rfc6532</a></li>
<li><a href="https://tools.ietf.org/html/rfc6854">https://tools.ietf.org/html/rfc6854</a></li>
<li><a href="http://code.google.com/p/isemail/">http://code.google.com/p/isemail/</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md8370"></a>
Props</h2>
<p>Many thanks to <a href="https://github.com/dominicsayers">Dominic Sayers</a> and his documentation and tests for the <a href="https://github.com/dominicsayers/isemail">is_email</a> function which helped greatly in writing this parser.</p>
<h2><a class="anchor" id="autotoc_md8371"></a>
License</h2>
<p>Licensed under the MIT License. See the LICENSE file. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
